<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
<link rel="stylesheet" href="Mappa.css"/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
<div id="map"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="limits_IT_provinces.geojson"></script>
<div id="pointer-button">
	<button>Query</button>
	<span id="query_result"></span>
</div>
<!-- <script>
	#### L.map('nome dell'id)
	var mymap = L.map('mapid').setView([51.505, -0.09], 13);
	
	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoiZmlsaGlwIiwiYSI6ImNrZjlpaWZ0ZTBtZHUyeG1xYzlxeTRqdTUifQ.8oibHPKzl3KPY3Gz5keLbg'
}).addTo(mymap);
</script> -->


<script>
	var mapboxAccessToken = 'pk.eyJ1IjoiZmlsaGlwIiwiYSI6ImNrZjlpaWZ0ZTBtZHUyeG1xYzlxeTRqdTUifQ.8oibHPKzl3KPY3Gz5keLbg';
	var map = L.map('map').setView([41.9, 12.6], 6);

	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=' + mapboxAccessToken, {
		maxZoom: 18,
		id: 'mapbox/light-v9',
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(map);
	
	function style(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.7,
			fillColor: '#FD8D3C'
		};
	}
	
	function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 5,
			color: '#666',
			dashArray: '',
			fillOpacity: 0.7
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}
	}
	
	var geojson;
	function resetHighlight(e) {
		geojson.resetStyle(e.target);
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function hello() {
		console.log("hello")
	}

	function DBquery(e) {
		$.ajax({
				url: 'http://localhost:8080/simple_query',
				data: {
					columns: "*",
					tables: "Regioni",
					conditions: "Regioni.nome_regione = 'Piemonte'"
				},
				dataType: "jsonp",
				cache: false,
				timeout: 5000,
				success: function(data) {
					var res = data;
					$("#query_result").html(JSON.stringify(res));
				},
				error: function (xhr, status, error) {
	            	console.log('Error: ' + error.message + ", status: " + status);
				},
			});
	}

	function adjustZoom(e) {
		if (e.target.getBounds() == map.getBounds()) {
			map.zoomOut()
		}
		else {
			zoomToFeature(e);
		}
	}

	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: adjustZoom
		});
	}

	geojson = L.geoJson(statesData, {
		//style: style,
		onEachFeature: onEachFeature
	}).addTo(map);

	$("#pointer-button").click(DBquery);
	
</script>